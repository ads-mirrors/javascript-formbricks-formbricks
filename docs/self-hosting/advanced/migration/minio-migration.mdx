---
title: "Migrate local uploads to MinIO"
description: "Detailed guide for migrating from local file storage to MinIO for Formbricks 4.0"
icon: "cloud"
---

## Why this migration is required

Formbricks 4.0 uses an S3‑compatible object store for all file uploads. For One‑Click installs that previously stored files locally (named volume `uploads` or a host bind like `./uploads`), you must migrate those files to MinIO.

This guide shows a safe, idempotent migration using the script `docker/migrate-to-minio.sh` included in this repository.

<Note>
  This migration script is supported on Ubuntu only (Ubuntu 20.04+), requiring Bash 4+ and GNU sed/grep.
</Note>

## Prerequisites

- **DNS Setup**: A subdomain for object storage (e.g., `files.yourdomain.com`) pointing to your server IP
- **System Requirements**: Ubuntu 20.04+ with Bash 4+ and GNU sed/grep
- **Docker/Compose**: Working Docker and Docker Compose installation
- Your One‑Click installation directory (contains `docker-compose.yml`)

## What the script does

The migration script will:
- Add MinIO services (`minio`, `minio-init`) and S3 environment variables to your `docker-compose.yml`
- Ask to restart your Compose stack (you should say Yes)
- Detect your existing upload sources post‑start and migrate them to MinIO:
  - Host bind mounts (e.g., `./uploads`)
  - Named volume target in the container (legacy: `/home/nextjs/apps/web/uploads` or custom target)
  - Absolute `UPLOADS_DIR` in the container if set
- Clean up `docker-compose.yml` after success: removes `UPLOADS_DIR`, removes all `uploads` volume mappings and the root `uploads:` definition
- Optionally restart again to apply the cleanup

The migration is idempotent: you can re‑run it; existing objects are not duplicated.

## Run the migration

From the directory that contains your `docker-compose.yml`:

```bash
# Download the latest script
curl -fsSL -o migrate-to-minio.sh \
  https://raw.githubusercontent.com/formbricks/formbricks/stable/docker/migrate-to-minio.sh

# Make it executable
chmod +x migrate-to-minio.sh

# Launch the guided migration
./migrate-to-minio.sh
```

## Verifying the migration

After the migration completes:

1. **Check the UI**: Previously uploaded images/logos/files should load correctly

2. **List bucket contents** to verify files were migrated:

```bash
docker compose run --rm --entrypoint /bin/sh minio-init -lc \
'mc alias set minio http://minio:9000 "$MINIO_ROOT_USER" "$MINIO_ROOT_PASSWORD" && \
 mc ls -r "minio/$MINIO_BUCKET_NAME" | head -200'
```

3. **Confirm cleanup**: Your `docker-compose.yml` should no longer contain `UPLOADS_DIR` or `uploads:` volume mappings (post‑cleanup)

## Notes on sources

The script migrates from multiple sources, in order:
- Host bind (absolute path resolved by `docker compose config`)
- Container mount target for named volume `uploads` (e.g., `/home/nextjs/apps/web/uploads` or your custom `.../files/uploads`)
- Absolute `UPLOADS_DIR` (container path)

The relative path/key structure is preserved: `${environmentId}/${accessType}/fileName.ext`

Re‑runs copy only new/changed files (idempotent).

## Troubleshooting

### MinIO 404 on file URLs

If you use virtual‑hosted style (`bucket.files.domain`), ensure Traefik router rule includes wildcard:

```
traefik.http.routers.minio-s3.rule=Host(`files.domain`) || HostRegexp(`{any:.+}.files.domain`)
```

### InvalidAccessKeyId in UI

This happens if keys were rotated between runs. Re‑run the script; it reuses S3\_\* credentials and reattaches policy.

### Undefined volume `minio-data`

Re‑run the script; it ensures `minio-data` exists in the root `volumes:` block.

### List bucket contents

```bash
docker compose run --rm --entrypoint /bin/sh minio-init -lc \
'mc alias set minio http://minio:9000 "$MINIO_ROOT_USER" "$MINIO_ROOT_PASSWORD"; \
 mc ls -r "minio/$MINIO_BUCKET_NAME" | head -200'
```

## Manual migration steps

If the automated script doesn't work for your setup, you can perform the migration manually:

### 1. Add MinIO services to docker-compose.yml

Add the following services to your `docker-compose.yml`:

```yaml
services:
  # ... your existing services ...

  minio:
    image: minio/minio:latest
    container_name: formbricks-minio
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: ${S3_ACCESS_KEY}
      MINIO_ROOT_PASSWORD: ${S3_SECRET_KEY}
    volumes:
      - minio-data:/data

  minio-init:
    image: minio/mc:latest
    container_name: formbricks-minio-init
    depends_on:
      - minio
    entrypoint: >
      /bin/sh -c "
      /usr/bin/mc alias set minio http://minio:9000 ${S3_ACCESS_KEY} ${S3_SECRET_KEY};
      /usr/bin/mc mb minio/${S3_BUCKET_NAME} --ignore-existing;
      /usr/bin/mc policy set public minio/${S3_BUCKET_NAME};
      exit 0;
      "

volumes:
  # ... your existing volumes ...
  minio-data:
```

### 2. Add environment variables

Add these environment variables to your Formbricks service:

```yaml
environment:
  # ... your existing environment variables ...
  S3_ACCESS_KEY: your-access-key
  S3_SECRET_KEY: your-secret-key
  S3_REGION: us-east-1
  S3_BUCKET_NAME: formbricks-uploads
  S3_ENDPOINT_URL: http://minio:9000
```

### 3. Restart and migrate files

1. Restart your stack: `docker compose up -d`
2. Copy files from your local storage to MinIO
3. Remove old volume mappings from docker-compose.yml
4. Restart again to apply changes

## Rollback

Your original `docker-compose.yml` is backed up as `docker-compose.yml.backup.<timestamp>`.

To revert, restore the backup and restart Compose:

```bash
cp docker-compose.yml.backup.<timestamp> docker-compose.yml
docker compose down && docker compose up -d
```

That's it — you're on the new MinIO storage for Formbricks 4.0. ✅
